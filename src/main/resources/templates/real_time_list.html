<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>实时状态</title>

    <link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">

    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">

    <script src="../js/cron/jquery.min.js"></script>
    <script src="../js/cron/bootstrap.min.js"></script>
    <script src="js/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="js/content.min.js?v=1.0.0"></script>
    <script src="js/local/realTime/realTime.js"></script>
    <script src="js/local/equipment/equipment.js"></script>

    <script src="../js/plugins/layer/laydate/laydate.js"></script>
    <script src="js/plugins/iCheck/icheck.min.js"></script>


    <script src="js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
    <script src="js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">



        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>基本 <small>分类，查找</small></h5>
                    <div class="ibox-tools">

                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>

                <div class="ibox-content">
                    <div class="col-sm-10" >
                        <form>
                            <select id="select-a" class="form-control m-b"  style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">设备号</option>

                            </select>
                            <select id="select-c" class="form-control m-b" style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">通讯状态</option>
                                <option value="1">断开</option>
                                <option value="0">正常</option>
                            </select>
                            <select id="select-d"  class="form-control m-b" style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">工作状态</option>
                                <option  value="0">空闲</option>
                                <option  value="1">充电中</option>
                                <option  value="2">充电结束</option>
                            </select>
                            <button id="search_btn"  style="margin-right:20px;" type="button" class="btn btn-w-m btn-success">查询</button>
                            <button type="reset" style="margin-right:20px;" class="btn btn-w-m btn-default">重置</button>
                            <a style="margin-right:20px;" class="btn btn-w-m btn-success" href="/realTimeListView">切换视图</a>
                        </form>
                    </div>

                    <!-- 表格 -->
                    <table  class="table table-striped table-bordered table-hover TadataTables-example datable"  id="realTime-table" ></table>

                </div>
            </div>
        </div>
    </div>
</div>




<script type="text/javascript">
    /**
     var pageNum=1;
     $(function(){
        equipmentlist(pageNum);
    })
     */
    class BstpTable{
        constructor(obj) {
            this.obj=obj;
        }
        inint(){

            //---先销毁表格 ---
            this.obj.bootstrapTable('destroy');
            //---初始化表格,动态从服务器加载数据---
            this.obj.bootstrapTable({
                //【发出请求的基础信息】
                url: '/realTime/realTimeList',
                method: 'post',
                contentType: "application/x-www-form-urlencoded",


                //【查询设置】
                queryParamsType:'',
                /**
                 queryParams: function queryParams(params) {

                    var param = {
                        pageNumber: params.pageNumber,
                        pageSize: params.pageSize,
                        equipmentno:params.equipmentno,
                        Name:$('#select-a').val(),
                        Name:$('#select-b').val(),
                        Name:$('#select-c').val(),
                        Name:$('#select-d').val(),
                    };
                    for(var key in searchArgs){
                        param[key]=searchArgs[key]
                    }
                    return param;

                },
                 */
                queryParams: queryParams,
                //【其它设置】
                locale:'zh-CN',//中文支持
                pagination: true,//是否开启分页（*）
                pageNumber:1,//初始化加载第一页，默认第一页
                pageSize: 10,//每页的记录行数（*）
                pageList: [10,50,100],//可供选择的每页的行数（*）
                sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
                showRefresh:true,//刷新按钮
                dataType: "json",
                uniqueId: "equipmentId",
                sortable: true,
                sortOrder: "asc",                   //排序方式
                showColumns: true,                  //是否显示所有的列（选择显示的列）
                showRefresh: true,                  //是否显示刷新按钮
                //bFilter: true,     //过滤功能
                //bSort: true,     //排序功能
                showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表



                responseHandler: function(res) {
                    return {
                        "total": res.data.recordsTotal,//总页数
                        "rows": res.data.list,   //数据
                        //  "sortColumnsName": res.sort,      //排序列名
                        //"sortOrder": res.order //排位命令（desc，asc）
                    };
                },
                //【设置列】
                columns: [
                    {
                        checkbox:true,
                    },
                    {field: 'equipmentNo',title: '设备号',sortable: true, },
                    {field: 'communicateStatus',title: '通讯状态',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var ok = "正常";
                            var  no = "断开";
                            var  nothing = "-";
                            if(str == "0"){
                                return ok;
                            }
                            if(str == "1"){
                                return no;
                            }
                            if(str == "3"){
                                return nothing;
                            }
                        }

                    },
                    {field: 'chargingGunStatus',title: '枪连接状态',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var ok = "已连接";
                            var  no = "未连接";
                            var  nothing = "-";
                            if(str == "0"){
                                return no;
                            }
                            if(str == "1"){
                                return ok;
                            }
                            if(str == "3"){
                                return nothing;
                            }
                        }
                    },
                    {field: 'workStatus',title: '工作状态',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var ok = "充电中";
                            var  free = "空闲";
                            var  stop = "充电结束";

                            var  nothing = "-";
                            if(str == "0"){
                                return free;
                            }
                            if(str == "1"){
                                return ok;
                            }
                            if(str == "2"){
                                return stop;
                            }
                            if(str == "3"){
                                return free;
                            }
                            return "-";


                        }
                    },
                    {field: 'faultStatus',title: '故障状态',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var ok = "正常";
                            var  no = "故障";
                            var  nothing = "-";
                            if(str == "0"){
                                return ok;
                            }
                            if(str == "1"){
                                return no;
                            }
                            if(str == "3"){
                                return nothing;
                            }

                        }
                    },
                    //{field: 'faultDesc',title: '故障描述',sortable: true},
                    {field: 'currentSoc',title: 'SOC',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    {field: 'outputVoltage',title: '电压(V)',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    {field: 'outputCurrent',title: '电流(A)',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    {field: 'outputPower',title: '功率(KW)',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    {field: 'startChargingDttm',title: '开始时间',sortable: true,
                        formatter:function (value,row,index) {
                            //日期时间戳转换
                            var time = new Date(value);

                            var y = time.getFullYear();//年
                            var m = time.getMonth() + 1;//月
                            var d = time.getDate();//日
                            var h = time.getHours();//时
                            var mm = time.getMinutes();//分
                            var s = time.getSeconds();//秒
                            //console.log(y);
                            if(y == "1970"){
                                return "-";
                            }
                            return y+"-"+m+"-"+d+" "+h+":"+mm+":"+s;
                        }},
                    {field: 'startChargingAmmeterNo',title: '开始表数',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    {field: 'ammeterNo',title: '电表数',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }

                        }
                    },
                    {field: 'chargedTime',title: '已充时间',sortable: true},
                    {field: 'chargedKwh',title: '已充电量(度)',sortable: true,
                        formatter:function (value,row,index) {
                            var str= value;
                            var  nothing = "-";
                            if(str == "0.0"){
                                return nothing;
                            }else{
                                return str;
                            }

                        }
                    },
                    //{field: 'hardwareVersion',title: '硬件版本',sortable: true},
                    //{field: 'softwareVersion',title: '软件版本',sortable: true},



                ]
            })
        }
    }
    var bstpTable=new BstpTable($("table"));
    bstpTable.inint({})
    $('.fixed-table-header').remove();


    //设备号
    $(function(){
        equipmentNo();
    })
    //请求服务数据时所传参数
    function queryParams(params){
        return{
            pageNumber: params.pageNumber,
            pageSize: params.pageSize,
            equipmentNo:$("#select-a option:selected").val(),
            communicateStatus :$("#select-c option:selected").val(),
            workStatus:$("#select-d option:selected").val()
        }
    }
    //查询按钮事件
    $('#search_btn').click(function(){
        $('#realTime-table').bootstrapTable('refresh', {url: '/realTime/realTimeList'});
    })

    setTimeout(function(){queryAll()},1000); //指定1秒刷新一次
    function queryAll() {
        setTimeout(function(){queryAll()},1000);
        $('#realTime-table').bootstrapTable('refresh',
            $.ajax({
                url :  '/realTime/realTimeList',
                type : "post",
                async:true,
                success : function (data) {
                    // console.log(data);
                }
            })
        );
    }


</script>

</body>

</html>
