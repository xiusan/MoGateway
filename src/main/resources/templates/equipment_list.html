<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>设备列表</title>

    <link rel="shortcut icon" href="favicon.ico">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
    <link href="css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">

    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">

    <script src="../js/cron/jquery.min.js"></script>
    <script src="../js/cron/bootstrap.min.js"></script>
    <script src="js/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="js/content.min.js?v=1.0.0"></script>
    <script src="js/local/equipment/equipment.js"></script>

    <script src="../js/plugins/layer/laydate/laydate.js"></script>
    <script src="js/plugins/iCheck/icheck.min.js"></script>


    <script src="js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
    <script src="js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

    <script src="js/content.min.js?v=1.0.0"></script>
    <script src="js/plugins/validate/jquery.validate.min.js"></script>
    <script src="js/plugins/validate/messages_zh.min.js"></script>

</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>基本
                        <small>分类，查找</small>
                    </h5>
                    <div class="ibox-tools">

                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="col-sm-10">
                        <form>
                            <select id="select-a" class="form-control m-b"
                                    style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">设备号</option>
                            </select>
                            <select id="select-c" class="form-control m-b"
                                    style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">协议类型</option>
                            </select>
                            <select id="select-d" class="form-control m-b"
                                    style="width:200px;margin-right:20px;float: left" name="account">
                                <option value="">是否监控</option>
                                <option value="0">是</option>
                                <option value="1">否</option>
                            </select>
                            <button id="search_btn" type="button" style="margin-right:20px"
                                    class="btn btn-w-m btn-success">查询
                            </button>
                            <button type="reset" class="btn btn-w-m btn-default" style="margin-right:20px">重置</button>
                        </form>
                    </div>
                    <div class="col-sm-10">
                        <a data-toggle="modal" class="btn btn-w-m btn-success" style="margin-right:20px"
                           href="form_basic.html#modal-form1">设备分配</a>
                        <!-- <button type="button" id="addPage" class="btn btn-w-m btn-success">设备分配</button>-->
                        <button type="button" id="start1" style="margin-right:20px"
                                class="btn btn-w-m btn-success start">启用
                        </button>
                        <button type="button" id="stop" style="margin-right:20px" class="btn btn-w-m btn-success stop">
                            禁用
                        </button>
                    </div>

                    <!-- 表格 -->
                    <table class="table table-striped table-bordered table-hover TadataTables-example datable"
                           id="queipment-table"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal-form1" class="modal fade" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="row">
                <div class="col-sm-12">

                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>添加设备</h5>
                            <div class="ibox-tools">
                                <a class="close-link">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <!--
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">设备数量：</label>
                                <div class="col-sm-8">
                                    <input name="count" style="margin-top: 20px;" type="text" class="form-control" >
                                </div>
                            </div>
                            -->
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">设备编号：</label>

                                <div class="col-sm-8">
                                    <input id="equipmentNo" style="margin-top: 20px;" name="equipmentNo" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">充电站：</label>

                                <div class="col-sm-8">
                                    <select name="chargingStationId" style="margin-top: 20px" id="chargingStationId"
                                            class="form-control m-b" name="chargingStationId"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">设备类型：</label>

                                <div class="col-sm-8">
                                    <select name="equipmentType" style="margin-top: 20px" id="equipmentType"
                                            class="form-control m-b" name="equipmentType"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">充电桩名称：</label>

                                <div class="col-sm-8">
                                    <input id="equipmentName" style="margin-top: 20px;" name="equipmentName" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <!--
                            <div class="form-group" >
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">设备类型：</label>

                                <div class="col-sm-8">
                                    <input  id="equipmentType" style="margin-top: 20px" name="equipmentType" type="text"  class="form-control">
                                </div>
                            </div>
                            -->
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">设备协议：</label>

                                <div class="col-sm-8">
                                    <select name="agreementId" style="margin-top: 20px" id="agreementId"
                                            class="form-control m-b" name="account"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">电表名称：</label>

                                <div class="col-sm-8">
                                    <select name="ammeterId" style="margin-top: 20px" id="ammeterId"
                                            class="form-control m-b" name="account"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">枪口类型：</label>

                                <div class="col-sm-8">
                                    <select name="chargingConnectorType" style="margin-top: 20px"
                                            id="chargingConnectorType" class="form-control m-b"
                                            name="chargingConnectorType"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">额定电压上限：</label>

                                <div class="col-sm-8">
                                    <input id="voltageUpperLimits" style="margin-top: 20px" name="voltageUpperLimits"
                                           type="text" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">额定电压下限：</label>

                                <div class="col-sm-8">
                                    <input id="voltageLowerLimits" style="margin-top: 20px" name="voltageLowerLimits"
                                           type="text" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">额定电流：</label>

                                <div class="col-sm-8">
                                    <input id="current" style="margin-top: 20px" name="current" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">额定功率：</label>

                                <div class="col-sm-8">
                                    <input id="power" style="margin-top: 20px" name="power" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">对应车位编号：</label>

                                <div class="col-sm-8">
                                    <input id="parkNo" style="margin-top: 20px" name="parkNo" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">国标：</label>

                                <div class="col-sm-8">
                                    <input id="nationalStandard" style="margin-top: 20px" name="nationalStandard"
                                           type="text" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">生产厂家：</label>

                                <div class="col-sm-8">
                                    <input id="manufacturer" style="margin-top: 20px" name="manufacturer" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">生产日期：</label>

                                <div class="col-sm-8">
                                    <input id="manufacturerDttm" style="margin-top: 20px" name="manufacturerDttm"
                                           class="form-control" placeholder="YYYY-MM-DD hh:mm:ss"
                                           onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label"
                                       style="float: left;margin-top: 20px;">投运日期：</label>

                                <div class="col-sm-8">
                                    <input id="deliveryDttm" style="margin-top: 20px" name="deliveryDttm"
                                           class="form-control" placeholder="YYYY-MM-DD hh:mm:ss"
                                           onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">桩编号：</label>

                                <div class="col-sm-8">
                                    <input id="deviceId" style="margin-top: 20px" name="deviceId" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="float: left;margin-top: 20px;">枪编号：</label>

                                <div class="col-sm-8">
                                    <input id="chargingGunNo" style="margin-top: 20px" name="chargingGunNo" type="text"
                                           class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-3 col-sm-8">
                                    <button id="addInfo" class="btn btn-w-m btn-success"
                                            style="margin-right:20px;margin-top: 20px" onclick="addInfo()" name="保存"
                                            value="保存" type="button"><strong>保存</strong>
                                    </button>
                                    <button type="button" class="btn btn-w-m btn-success "
                                            style="margin-right:20px;margin-top: 20px" data-dismiss="modal">
                                        <strong>取消</strong></button>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    /**
     var pageNum=1;
     $(function(){
        equipmentlist(pageNum);
    })
     */
    class BstpTable {
        constructor(obj) {
            this.obj = obj;
        }

        inint() {
            //---先销毁表格 ---
            this.obj.bootstrapTable('destroy');
            //---初始化表格,动态从服务器加载数据---
            this.obj.bootstrapTable({
                //【发出请求的基础信息】
                url: '/equipment/equipmentList',
                method: 'post',
                contentType: "application/x-www-form-urlencoded",
                //【查询设置】
                queryParamsType: '',
                /**
                 queryParams: function queryParams(params) {

                    var param = {
                        pageNumber: params.pageNumber,
                        pageSize: params.pageSize,
                        equipmentno:params.equipmentno,
                        Name:$('#select-a').val(),
                        Name:$('#select-b').val(),
                        Name:$('#select-c').val(),
                        Name:$('#select-d').val(),
                    };
                    for(var key in searchArgs){
                        param[key]=searchArgs[key]
                    }
                    return param;

                },
                 */
                queryParams: queryParams,
                //【其它设置】
                locale: 'zh-CN',//中文支持
                pagination: true,//是否开启分页（*）
                pageNumber: 1,//初始化加载第一页，默认第一页
                pageSize: 10,//每页的记录行数（*）
                pageList: [10, 50, 100],//可供选择的每页的行数（*）
                sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
                showRefresh: true,//刷新按钮
                dataType: "json",
                uniqueId: "equipmentId",
                sortable: true,
                sortOrder: "asc",                   //排序方式
                showColumns: true,                  //是否显示所有的列（选择显示的列）
                showRefresh: true,                  //是否显示刷新按钮
                //bFilter: true,     //过滤功能
                //bSort: true,     //排序功能
                responseHandler: function (res) {
                    return {
                        "total": res.data.recordsTotal,//总页数
                        "rows": res.data.list,   //数据
                        //  "sortColumnsName": res.sort,      //排序列名
                        //"sortOrder": res.order //排位命令（desc，asc）
                    };
                },
                //【设置列】
                columns: [
                    {
                        checkbox: true,
                    },
                    {field: 'equipmentName', title: '设备名称', sortable: true,},
                    {field: 'equipmentNo', title: '设备号', sortable: true},
                    {field: 'chargingStatioNname', title: '充电站', sortable: true},
                    {
                        field: 'active', title: '是否监控', sortable: true,
                        formatter: function (value, row, index) {
                            var str = value;
                            var ok = "是";
                            var no = "否";
                            if (str == "0") {
                                return ok;
                            }
                            if (str == "1") {
                                return no;
                            }

                        }
                    },
                    {field: 'equipmentTypeName', title: '设备类型', sortable: true},
                    {field: 'agreementName', title: '协议类型', sortable: true},
                    {field: 'chargingConnectorName', title: '枪口类型', sortable: true},
                    {field: 'voltageUpperLimits', title: '额定电压上限', sortable: true},
                    {field: 'voltageLowerLimits', title: '额定电压下限', sortable: true},
                    {field: 'current', title: '额定电流', sortable: true},
                    {field: 'power', title: '额定功率', sortable: true},
                    {field: 'parkNo', title: '对应车位编号', sortable: true},
                    {field: 'nationalStandard', title: '国标', sortable: true},
                    {field: 'manufacturer', title: '生产厂家', sortable: true},
                    {
                        field: 'manufacturerDttm', title: '生产日期', sortable: true,
                        formatter: function (value, row, index) {
                            //日期时间戳转换
                            var time = new Date(value);
                            var y = time.getFullYear();//年
                            var m = time.getMonth() + 1;//月
                            var d = time.getDate();//日
                            var h = time.getHours();//时
                            var mm = time.getMinutes();//分
                            var s = time.getSeconds();//秒
                            return y + "-" + m + "-" + d + " " + h + ":" + mm + ":" + s;
                        }
                    },
                    {
                        field: 'deliveryDttm', title: '投运日期', sortable: true,
                        formatter: function (value, row, index) {
                            //日期时间戳转换
                            var time = new Date(value);
                            var y = time.getFullYear();//年
                            var m = time.getMonth() + 1;//月
                            var d = time.getDate();//日
                            var h = time.getHours();//时
                            var mm = time.getMinutes();//分
                            var s = time.getSeconds();//秒
                            return y + "-" + m + "-" + d + " " + h + ":" + mm + ":" + s;
                        }
                    },
                    {field: 'deviceId', title: '桩编号', sortable: true},
                    {field: 'chargingGunNo', title: '枪编号', sortable: true}
                ]
            })
        }
    }

    var bstpTable = new BstpTable($("table"));
    bstpTable.inint({})
    $('.fixed-table-header').remove();

    //查询加载设备号，协议类型，是否监控
    //协议类型
    $(function () {
        agreementList();
    })

    //设备号
    $(function () {
        equipmentNo();
    })
    //启用
    $(function () {
        updateStart();
    })

    //禁用
    $(function () {
        updateStop();
    })

    //设备分配 协议类型
    $(function () {
        agreementType();
    })
    //电表
    $(function () {
        ammeterList();
    })
    //设备类型
    $(function () {
        equipmentTypeList();
    })
    //枪口类型
    $(function () {
        charingConnectorTypeList();
    })
    //充电站类型
    $(function () {
        chargingstationList();
    })

    //请求服务数据时所传参数
    function queryParams(params) {
        return {
            pageNumber: params.pageNumber,
            pageSize: params.pageSize,
            sortColumnsName: params.sortName,
            //sortColumnsName: "name",
            //sortOrder: "sort",
            sortOrder: params.sortOrder,
            equipmentNo: $("#select-a option:selected").val(),
            agreementId: $("#select-c option:selected").val(),
            //agreementid:$('#select-c option:selected ').val(),
            active: $("#select-d option:selected").val()

        }
    }

    //查询按钮事件
    $('#search_btn').click(function () {
        $('#queipment-table').bootstrapTable('refresh', {url: '/equipment/equipmentList'});
    })

    //laydate({elem:"#manufacturerDttm",event:"focus"});
    //laydate({elem:"#deliveryDttm",event:"focus"});

</script>

</body>

</html>
